#-----------------------------------------------------------
# Vivado v2020.1 (64-bit)
# SW Build 2902540 on Wed May 27 19:54:35 MDT 2020
# IP Build 2902112 on Wed May 27 22:43:36 MDT 2020
# Start of session at: Fri Jul  1 16:40:53 2022
# Process ID: 30397
# Current directory: /home/taylor/Documents/new_spgd
# Command line: vivado -source make_project.tcl
# Log file: /home/taylor/Documents/new_spgd/vivado.log
# Journal file: /home/taylor/Documents/new_spgd/vivado.jou
#-----------------------------------------------------------
start_gui
source make_project.tcl
update_compile_order -fileset sources_1
update_compile_order -fileset sources_1
create_bd_cell -type module -reference SPGD_SYS SPGD_SYS
create_bd_cell -type module -reference ADC_fp ADC_fp
create_bd_cell -type module -reference fp_DAC fp_DAC_0
create_bd_cell -type module -reference fp_DAC fp_DAC_1
#create_bd_cell -type module -reference GPIO_BOX GPIO_BOX
#create_bd_cell -type module -reference configer configer
#create_bd_cell -type module -reference offset_ADC_to_AXIS offset_ADC_to_AXIS
#create_bd_cell -type module -reference ADC_cal_fp_constants ADC_cal_fp_constants
#create_bd_cell -type module -reference AXIS_to_GPIO AXIS_to_GPIO
# Zynq processing system with RedPitaya specific preset
startgroup
create_bd_cell -type ip -vlnv xilinx.com:ip:processing_system7 processing_system7_0
set_property -dict [list CONFIG.PCW_USE_S_AXI_HP0 {1}] [get_bd_cells processing_system7_0]
#set_property -dict [list CONFIG.PCW_IMPORT_BOARD_PRESET {cfg/red_pitaya.xml}] [get_bd_cells processing_system7_0]
apply_bd_automation -rule xilinx.com:bd_rule:processing_system7 -config {make_external "FIXED_IO, DDR" Master "Disable" Slave "Disable" }  [get_bd_cells processing_system7_0]
connect_bd_net [get_bd_pins processing_system7_0/M_AXI_GP0_ACLK] [get_bd_pins processing_system7_0/FCLK_CLK0]
connect_bd_net [get_bd_pins processing_system7_0/S_AXI_HP0_ACLK] [get_bd_pins processing_system7_0/FCLK_CLK0]
endgroup
# AXI GPIO IP core
startgroup
create_bd_cell -type ip -vlnv xilinx.com:ip:axi_gpio axi_gpio_0
set_property -dict [list CONFIG.C_IS_DUAL {1} CONFIG.C_ALL_INPUTS_2 {1} CONFIG.C_ALL_OUTPUTS_2 {0}] [get_bd_cells axi_gpio_0]
#set_property -dict [list CONFIG.C_ALL_INPUTS_2 {0} CONFIG.C_ALL_OUTPUTS_2 {1}] [get_bd_cells axi_gpio_0]
#set_property -dict [list ] [get_bd_cells axi_gpio_0]
connect_bd_net [get_bd_pins axi_gpio_0/gpio_io_i] [get_bd_pins axi_gpio_0/gpio_io_o]
endgroup
apply_bd_automation -rule xilinx.com:bd_rule:axi4 -config {Master "/processing_system7_0/M_AXI_GP0" Clk "Auto" }  [get_bd_intf_pins axi_gpio_0/S_AXI]
set_property offset 0x42000000 [get_bd_addr_segs {processing_system7_0/Data/SEG_axi_gpio_0_Reg}]
set_property range 4K [get_bd_addr_segs {processing_system7_0/Data/SEG_axi_gpio_0_Reg}]
# Buffers for differential IOs
startgroup
create_bd_cell -type ip -vlnv xilinx.com:ip:util_ds_buf:2.1 util_ds_buf_0
set_property -dict [list CONFIG.C_SIZE {6}] [get_bd_cells util_ds_buf_0]
connect_bd_net [get_bd_ports adc_dat_a_p_i] [get_bd_pins util_ds_buf_0/IBUF_DS_P]
connect_bd_net [get_bd_ports adc_dat_a_n_i] [get_bd_pins util_ds_buf_0/IBUF_DS_N]
create_bd_cell -type ip -vlnv xilinx.com:ip:util_ds_buf:2.1 util_ds_buf_1
set_property -dict [list CONFIG.C_SIZE {6}] [get_bd_cells util_ds_buf_1]
connect_bd_net [get_bd_ports adc_dat_b_p_i] [get_bd_pins util_ds_buf_1/IBUF_DS_P]
connect_bd_net [get_bd_ports adc_dat_b_n_i] [get_bd_pins util_ds_buf_1/IBUF_DS_N]
endgroup
# Define all 8 LEDs
set_property LEFT 7 [get_bd_ports led_o]
startgroup
create_bd_cell -type ip -vlnv xilinx.com:ip:xlconcat:2.1 xlconcat_0
set_property -dict [list CONFIG.IN0_WIDTH {6} CONFIG.IN1_WIDTH {6}] [get_bd_cells xlconcat_0]
endgroup
connect_bd_net [get_bd_pins xlconcat_0/In0] [get_bd_pins util_ds_buf_0/IBUF_OUT]
connect_bd_net [get_bd_pins xlconcat_0/In1] [get_bd_pins util_ds_buf_1/IBUF_OUT]
connect_bd_net [get_bd_pins ADC_REG/data_in] [get_bd_pins xlconcat_0/dout]
connect_bd_net [get_bd_pins ADC_REG/adc_clk_p] [get_bd_ports adc_clk_p]
connect_bd_net [get_bd_pins ADC_REG/adc_clk_n] [get_bd_ports adc_clk_n]
connect_bd_net [get_bd_pins ADC_fp/ADC_CLK] [get_bd_pins ADC_REG/adc_clk]
connect_bd_net [get_bd_pins ADC_fp/ADC_SEL] [get_bd_pins SPGD_SYS/ADC_SEL]
connect_bd_net [get_bd_pins ADC_fp/ADC_EN] [get_bd_pins SPGD_SYS/ADC_EN]
connect_bd_net [get_bd_pins ADC_fp/ADC_A] [get_bd_pins ADC_REG/a_data_out]
connect_bd_net [get_bd_pins ADC_fp/ADC_B] [get_bd_pins ADC_REG/b_data_out]
connect_bd_net [get_bd_pins ADC_fp/ADC_DONE] [get_bd_pins SPGD_SYS/ADC_DONE]
connect_bd_net [get_bd_pins ADC_fp/ADC_16Q48_OUT] [get_bd_pins SPGD_SYS/ADC_IN]
connect_bd_net [get_bd_pins SPGD_SYS/ADC_CLK] [get_bd_pins ADC_REG/adc_clk]
connect_bd_net [get_bd_pins SPGD_SYS/DAC_A_OUT] [get_bd_pins fp_DAC_0/fp_in]
connect_bd_net [get_bd_pins SPGD_SYS/DAC_B_OUT] [get_bd_pins fp_DAC_1/fp_in]
connect_bd_net [get_bd_pins SPGD_SYS/GP_IN] [get_bd_pins axi_gpio_0/gpio_io_o]
connect_bd_net [get_bd_pins SPGD_SYS/GP_OUT] [get_bd_pins axi_gpio_0/gpio2_io_i]
connect_bd_net [get_bd_ports dac_spi_clk_o] [get_bd_pins SPGD_SYS/val_0]
connect_bd_net [get_bd_ports dac_spi_csb_o] [get_bd_pins SPGD_SYS/val_0]
connect_bd_net [get_bd_ports dac_spi_reset_o] [get_bd_pins SPGD_SYS/val_0]
connect_bd_net [get_bd_pins SPGD_SYS/val_1] [get_bd_ports dac_spi_sdio_o] 
connect_bd_net [get_bd_pins fp_DAC_0/DAC_out] [get_bd_ports dac_dat_a_o]
connect_bd_net [get_bd_pins fp_DAC_1/DAC_out] [get_bd_ports dac_dat_b_o]
# ====================================================================================
# Generate output products and wrapper, add constraint 
generate_target all [get_files  $bd_path/system.bd]
make_wrapper -files [get_files $bd_path/system.bd] -top
add_files -norecurse $bd_path/hdl/system_wrapper.v
# Load RedPitaya constraint files
set files [glob -nocomplain cfg/*.xdc]
if {[llength $files] > 0} {
  add_files -norecurse -fileset constrs_1 $files
}
#set_property top system_wrapper [current_fileset]
set_property VERILOG_DEFINE {TOOL_VIVADO} [current_fileset]
set_property STRATEGY Flow_PerfOptimized_High [get_runs synth_1]
set_property STRATEGY Performance_NetDelay_high [get_runs impl_1]
group_bd_cells PS7 [get_bd_cells processing_system7_0] [get_bd_cells rst_ps7_0_50M] [get_bd_cells ps7_0_axi_periph] [get_bd_cells axi_gpio_0]
group_bd_cells ADC_BLOCK [get_bd_cells util_ds_buf_0] [get_bd_cells util_ds_buf_1] [get_bd_cells xlconcat_0] [get_bd_cells ADC_REG]
set_property top system_wrapper [current_fileset]
update_compile_order -fileset sources_1
regenerate_bd_layout
regenerate_bd_layout
save_bd_design
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
update_module_reference system_SPGD_SYS_0
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
reset_run synth_1
reset_run system_SPGD_SYS_0_synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
reset_run synth_1
reset_run system_SPGD_SYS_0_synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
reset_run synth_1
reset_run system_SPGD_SYS_0_synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
add_files gen_reg.v
cd src
add_files gen_reg.v
cd ..
reset_run synth_1
reset_run system_SPGD_SYS_0_synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
update_module_reference system_SPGD_SYS_0
update_module_reference system_SPGD_SYS_0
connect_bd_net [get_bd_ports led_o] [get_bd_pins SPGD_SYS/LED_O]
regenerate_bd_layout
save_bd_design
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
open_run impl_1
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
close_design
update_module_reference system_SPGD_SYS_0
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
update_module_reference system_SPGD_SYS_0
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
update_module_reference system_SPGD_SYS_0
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
update_module_reference system_SPGD_SYS_0
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
open_run impl_1
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
open_bd_design {/home/taylor/Documents/new_spgd/tmp/new_spgd/new_spgd.srcs/sources_1/bd/system/system.bd}
update_module_reference system_SPGD_SYS_0
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
open_bd_design {/home/taylor/Documents/new_spgd/tmp/new_spgd/new_spgd.srcs/sources_1/bd/system/system.bd}
create_ip_run [get_files -of_objects [get_fileset sources_1] /home/taylor/Documents/new_spgd/tmp/new_spgd/new_spgd.srcs/sources_1/bd/system/system.bd]
synth_design -rtl -name rtl_1
open_bd_design {/home/taylor/Documents/new_spgd/tmp/new_spgd/new_spgd.srcs/sources_1/bd/system/system.bd}
update_module_reference system_ADC_fp_0
update_module_reference system_SPGD_SYS_0
connect_bd_net [get_bd_pins SPGD_SYS/REG_RESET] [get_bd_pins ADC_fp/REG_RST]
regenerate_bd_layout
save_bd_design
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
reset_run synth_1
reset_run system_ADC_fp_0_synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
open_bd_design {/home/taylor/Documents/new_spgd/tmp/new_spgd/new_spgd.srcs/sources_1/bd/system/system.bd}
ls
pwd
cd src
add_files gen_reg.v
update_module_reference system_ADC_fp_0
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
update_module_reference system_SPGD_SYS_0
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
update_module_reference system_SPGD_SYS_0
update_module_reference system_SPGD_SYS_0
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
update_module_reference system_SPGD_SYS_0
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
update_module_reference system_SPGD_SYS_0
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
64+16
update_module_reference system_SPGD_SYS_0
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
update_module_reference system_SPGD_SYS_0
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
update_module_reference {system_fp_DAC_0_0 system_fp_DAC_1_0}
pwd
add_files DAC_OR_CHECK.v
update_compile_order -fileset sources_1
update_module_reference {system_fp_DAC_0_0 system_fp_DAC_1_0}
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
update_module_reference {system_fp_DAC_0_0 system_fp_DAC_1_0}
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
update_module_reference {system_fp_DAC_0_0 system_fp_DAC_1_0}
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
update_module_reference system_SPGD_SYS_0
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
update_module_reference system_SPGD_SYS_0
reset_run synth_1
launch_runs impl_1 -to_step write_bitstream -jobs 16
wait_on_run impl_1
